function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,_toPropertyKey(l.key),l)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0===a)return("string"===t?String:Number)(e);a=a.call(e,t||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}(d=>{d.fn.numberstyle=function(e){var m=d.extend({value:0,step:void 0,min:void 0,max:void 0},e);return this.each(function(e){var l=d(this),t=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div"),s=m.min||l.attr("min"),i=m.max||l.attr("max"),r=m.value||parseFloat(l.val());function u(){var e=l.closest(".ulmc-input__with-sign");e.length&&(e=e.find(".ulmc-input__text-placeholder").outerWidth(),l.css("padding-left",e+13+"px"))}function o(){var e=parseFloat(l.val()),t=l.siblings(".custom-number-input__qty-btn--add"),a=l.siblings(".custom-number-input__qty-btn--rem");void 0!==s&&e<=s?a.addClass("disabled"):a.removeClass("disabled"),void 0!==i&&i<=e?t.addClass("disabled"):t.removeClass("disabled")}t.className="custom-number-input__qty",a.className=i&&i<=r?"custom-number-input__qty-btn custom-number-input__qty-btn--add disabled":"custom-number-input__qty-btn custom-number-input__qty-btn--add",a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="13" height="8" viewBox="0 0 13 8" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5935 7.76544L6.15688 3.00771L1.39915 7.44437L0.0488594 5.99636L6.2546 0.209413L12.0415 6.41516L10.5935 7.76544Z" fill="currentColor"/></svg>',n.className=s&&r<=s?"custom-number-input__qty-btn custom-number-input__qty-btn--rem disabled":"custom-number-input__qty-btn custom-number-input__qty-btn--rem",n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="13" height="9" viewBox="0 0 13 9" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5935 0.863464L6.15688 5.6212L1.39915 1.18454L0.0488592 2.63255L6.2546 8.41949L12.0415 2.21375L10.5935 0.863464Z" fill="currentColor"/></svg>',l.wrap(t),l.closest(".custom-number-input__qty").prepend(a).append(n),u(),d(window).on("resize",u),d(document).off("mousedown",".custom-number-input__qty-btn").on("mousedown",".custom-number-input__qty-btn",function(e){e.preventDefault();var t,a,l=d(this),n=l.siblings("input"),s=m.step?parseFloat(m.step):parseFloat(n.attr("step"))||.01,i=m.min?parseFloat(m.min):n.attr("min")?parseFloat(n.attr("min")):void 0,r=m.max?parseFloat(m.max):n.attr("max")?parseFloat(n.attr("max")):void 0,u=!1;function c(){var e,t=parseFloat(n.val());l.hasClass("custom-number-input__qty-btn--add")?(e=t+s,void 0!==r&&r<e&&(e=r)):(e=t-s,void 0!==i&&e<i&&(e=i)),e=parseFloat(e.toFixed(2)),n.val(e).trigger("change"),o(),u=!0}l.addClass("clicked"),a=setTimeout(function(){c(),t=setInterval(c,200)},600),d(document).on("mouseup mouseleave",function e(){clearTimeout(a),clearInterval(t),l.removeClass("clicked"),u||c(),d(document).off("mouseup mouseleave",e)})}),l.on("change",function(){var e=parseFloat(l.val());void 0!==i&&i<e&&l.val(i),void 0!==s&&e<s&&l.val(s),o(),u()}),o()})}})(jQuery),(c=>{var e=(()=>_createClass(function e(){_classCallCheck(this,e),this.widgetClass=".ultimate-loan-mortgage-calculator",this.result={},this.data={},this.calculatorID=0},[{key:"init",value:function(){var e=c(this.widgetClass);this.calculatorID=e.attr("id"),this.dateInit(),this.setCalculatorData(),this.selectInit(),this.customNumberInputInit(),this.switchInit(),this.setCssVariables(),this.showHelp(),this.showScheduleTable(),this.changeOptions(),this.sendEmail(),this.calculateResult(),c(e).length&&c("body").addClass("ultimate-loan-mortgage-calculator-page")}},{key:"customNumberInputInit",value:function(){c.fn.numberstyle&&(c(".ulmc_loan_balance").length&&c(".ulmc_loan_balance").numberstyle(),c(".ulmc_interest_rate").length&&c(".ulmc_interest_rate").numberstyle(),c(".ulmc_term_years").length&&c(".ulmc_term_years").numberstyle(),c(".ulmc_term_months").length&&c(".ulmc_term_months").numberstyle(),c(".ulmc_down_payment").length)&&c(".ulmc_down_payment").numberstyle()}},{key:"setCalculatorData",value:function(){var e,t=c(this.widgetClass),a=(this.data.acceptance=+t.find("[name=ulmc_user_acceptance]").val(),this.data.loanBalance=+t.find(".ulmc_loan_balance").val(),+t.find(".ulmc_interest_rate").val()),a=(this.data.baseInterestRate=a,this.data.interestRate=a/100,this.data.termYears=t.find(".ulmc_term_years").val()?+t.find(".ulmc_term_years").val():0,this.data.termMonths=t.find(".ulmc_term_months").val()?+t.find(".ulmc_term_months").val():0,this.data.totalMonths=12*this.data.termYears+this.data.termMonths,this.data.firstPaymentDate=t.find(".ulmc_date_payment").datepicker("getDate"),t.find(".ulmc_payment_frequency").val()),l=(this.data.paymentFrequency=a,t.find(".ulmc_result_payment_frequency"));switch(a){case"semi-annually":e=2;break;case"quarterly":e=4;break;case"monthly":e=12;break;case"fortnightly":e=26;break;case"weekly":e=52;break;default:e=12}this.data.paymentsPerYear=e,l.text(a);l=t.find(".ulmc_currency_symbol");this.data.currency=l.text(),this.data.currencyCode=l.attr("data-currency")}},{key:"selectInit",value:function(){var e;c.fn.customSelect&&(e=this,c(".ulmc_payment_frequency").customSelect({block:"ulmc-select",includeValue:!0,hideCallback:function(){e.setCalculatorData(),e.calculateResult()}}))}},{key:"dateInit",value:function(){var a=this,e=new Date,t=c(".ulmc_date_payment").attr("data-format"),l=(this.data.date_format=t,c.datepicker.formatDate(t,e));c(".ulmc_date_payment").val(l),c(".ulmc_date_payment").datepicker({dateFormat:t,defaultDate:e,onSelect:function(e,t){a.data.firstPaymentDate=c(this).datepicker("getDate"),a.calculateResult()}})}},{key:"changeOptions",value:function(){var t=this,a=c(this.widgetClass);c(".ulmc_term_years, .ulmc_term_months").on("change",t.adjustTermFields),c(".ulmc_term_years, .ulmc_term_months").on("blur",t.adjustTermFields),c(".ulmc-settings input").on("change",function(){t.setCalculatorData(),t.calculateResult()}),c(".ulmc_payment_frequency").on("select2:select",function(e){e=e.params.data;a.find(".ulmc_payment_frequency").val(e.id),t.setCalculatorData(),t.calculateResult()})}},{key:"calculateResult",value:function(){var e,t,a,l=this.data;return l.loanBalance&&l.interestRate&&l.totalMonths?(e=l.totalMonths/12*l.paymentsPerYear,l=(a=(t=l.loanBalance*(t=l.interestRate/l.paymentsPerYear)/(1-Math.pow(1+t,-e)))*e)-l.loanBalance,this.result.numberOfPayments=e,this.result.paymentAmount=t.toFixed(2),this.result.totalCost=a.toFixed(2),this.result.totalInterest=l.toFixed(2),this.updateCounter(),void this.updateScheduleTable()):0}},{key:"calculateSchedule",value:function(){for(var e=this.data.loanBalance,t=[],a="",l=(this.data.firstPaymentDate&&(a=this.data.firstPaymentDate),12/this.data.paymentsPerYear),n=1;n<=this.result.numberOfPayments;n++){var s=e*this.data.interestRate/this.data.paymentsPerYear,i=this.result.paymentAmount-s,r=e-(i=n===this.result.numberOfPayments?e:i),u=a?c.datepicker.formatDate(this.data.date_format,a):"";t.push({paymentNumber:n,paymentDate:u,openingBalance:e.toFixed(2),principalPayment:i.toFixed(2),interestPayment:s.toFixed(2),closingBalance:r.toFixed(2)}),e=r,a&&a.setMonth(a.getMonth()+l)}return Math.abs(e)<.01&&(t[t.length-1].closingBalance="0.00"),t}},{key:"createScheduleTable",value:function(e){var t=this,a="";return e.forEach(function(e){a=(a=(a=(a=(a=(a=(a+="<tr>")+"<td>"+e.paymentNumber+"</td>")+"<td>"+e.paymentDate+"</td>")+"<td>"+t.formatMoneyValue(+e.openingBalance)+"</td>")+"<td>"+t.formatMoneyValue(+e.principalPayment)+"</td>")+"<td>"+t.formatMoneyValue(+e.interestPayment)+"</td>")+"<td>"+t.formatMoneyValue(+e.closingBalance)+"</td></tr>"}),a}},{key:"updateScheduleTable",value:function(){c(".ulmc_schedule_table tbody").html(""),c(".ulmc_principal_heading").text(this.data.paymentFrequency+" Principal"),c(".ulmc_interest_heading").text(this.data.paymentFrequency+" Interest");var e=this.calculateSchedule();this.result.scheduleHTML=this.createScheduleTable(e),c(".ulmc_schedule_table tbody").append(this.result.scheduleHTML)}},{key:"updateCounter",value:function(){var e=c(this.widgetClass),e={paymentAmount:e.find(".ulmc_result_payment_amount"),totalCost:e.find(".ulmc_result_total_cost"),totalInterest:e.find(".ulmc_result_total_interest")},t=this.result;this.animateCounter(e.paymentAmount,t.paymentAmount),this.animateCounter(e.totalCost,t.totalCost),this.animateCounter(e.totalInterest,t.totalInterest)}},{key:"animateCounter",value:function(t,e){t.length&&e&&0<e&&jQuery({Counter:0}).animate({Counter:e},{duration:400,easing:"swing",step:function(e){t.text(Math.ceil(e))},done:function(){t.text(ulmc.formatMoneyValue(this.Counter,ulmc.data.currency))}})}},{key:"sendEmail",value:function(){var t=this;c(".ulmc_send_result").off().click(function(e){e.preventDefault();e=c(this).closest("form");t.formSubmit(e,".ulmc_send_result")})}},{key:"formSubmit",value:function(e,t){var a=this,l=e.parents(a.widgetClass),n={loan_balance:this.formatMoneyValue(+this.data.loanBalance,a.data.currency),interest_rate:this.data.baseInterestRate,loan_term_years:this.data.termYears,loan_term_months:this.data.termMonths,payment_frequency:this.data.paymentFrequency,number_of_payments:this.result.numberOfPayments,payment_amount:this.formatMoneyValue(+this.result.paymentAmount,a.data.currency),total_cost:this.formatMoneyValue(+this.result.totalCost,a.data.currency),total_interest:this.formatMoneyValue(+this.result.totalInterest,a.data.currency),schedule:this.result.scheduleHTML},n={action:"ulmc_send_result",submit_button:t,user_email:l.find(".ulmc_user_email").length?l.find(".ulmc_user_email").val():"",data:JSON.stringify(n),nonce:c("#ulmc_nonce_"+this.calculatorID).val(),calculator_id:this.calculatorID},s=a.formValidate(l);s.filled_fields&&s.required_fields&&s.valid_fields&&s.acceptance?(e.find(t).addClass("ulmc-loading"),a.ajaxResponse(e,n)):c.each(s,function(e,t){a.displayError(l,e,t)})}},{key:"formValidate",value:function(e){var t={filled_fields:!0,required_fields:!0,valid_fields:!0,acceptance:!0};return t.filled_fields=ulmc.validateCalculatorFields(e),e.find(".ulmc-metric input").on("keyup",function(){var e=c(this).parents(ulmc.widgetClass);t.filled_fields=ulmc.validateCalculatorFields(e),ulmc.displayError(e,"filled_fields",t.filled_fields)}),t.required_fields=ulmc.validateFormFields(e),e.find(".ulmc-result-form-field").on("keyup",function(){var e=c(this).parents(ulmc.widgetClass);t.required_fields=ulmc.validateFormFields(e),ulmc.displayError(e,"required_fields",t.required_fields)}),t.valid_fields=ulmc.validateFormValues(e),e.find(".ulmc-result .ulmc-validate").on("focusout",function(){var e=c(this).parents(ulmc.widgetClass);t.valid_fields=ulmc.validateFormValues(e),ulmc.displayError(e,"valid_fields",t.valid_fields)}),e.find(".ulmc-result .ulmc-validate").on("keyup",function(){var e=c(this).parents(ulmc.widgetClass);t.valid_fields=ulmc.validateFormValues(e),1==t.valid_fields&&ulmc.displayError(e,"valid_fields",t.valid_fields)}),t.acceptance=ulmc.validateAcceptance(e),e.find(".ulmc-checkbox--privacy input").on("change",function(){t.acceptance=ulmc.validateAcceptance(e),ulmc.displayError(e,"acceptance",t.acceptance)}),t}},{key:"ajaxResponse",value:function(t,e){var a=this,l=t.parents(a.widgetClass);c.post(window.ulmc_vars.ajaxurl,e,function(e){t.find("button").removeClass("ulmc-loading"),e.success&&(a.addNotice(l,"success","send_success",e.data.success_message),l.find(".ulmc_user_email").val(""),t.find(".ulmc_send_result").removeClass("ulmc-loading"),t.slideUp())})}},{key:"validateCalculatorFields",value:function(a){var l=[],e={loan_balance:a.find(".ulmc_loan_balance").val(),interest_rate:a.find(".ulmc_interest_rate").val()};c.each(e,function(e,t){t&&""!==t?(l[e]=!0,a.find(".ulmc_"+e).removeClass("ulmc-empty")):(l[e]=!1,a.find(".ulmc_"+e).addClass("ulmc-empty"))});var e=a.find(".ulmc_term_years").val()?+a.find(".ulmc_term_years").val():0,t=a.find(".ulmc_term_months").val()?+a.find(".ulmc_term_months").val():0;return e||t?(a.find(".ulmc_term_years").removeClass("ulmc-empty"),a.find(".ulmc_term_months").removeClass("ulmc-empty"),l.term=!0):(a.find(".ulmc_term_years").addClass("ulmc-empty"),a.find(".ulmc_term_months").addClass("ulmc-empty"),l.term=!1),Object.values(l).every(Boolean)}},{key:"adjustTermFields",value:function(){var e,t=c(".ulmc_term_years"),a=c(".ulmc_term_months"),l=parseInt(a.val()),n=parseInt(t.val());12<=l&&(e=Math.floor(l/12),l%=12,t.val(n+=e),a.val(l))}},{key:"validateFormFields",value:function(l){var n=[],s=l.find(".ulmc-save-result__form-field");return s.each(function(){var e=!!c(this).attr("required"),t=c(this).attr("name"),a=c(this).val();e&&""===a?(c(this).addClass("ulmc-save-result__form-field--error"),n[t]=!1):(n[t]=!0,!c(s).hasClass("ulmc-validate")||ulmc.validateFormValues(l)?c(this).removeClass("ulmc-save-result__form-field--error"):c(this).addClass("ulmc-save-result__form-field--error"))}),Object.values(n).every(Boolean)}},{key:"validateFormValues",value:function(e){var l=[];return e.find(".ulmc-result .ulmc-validate").each(function(){var e=c(this).attr("name"),t=c(this).val(),a="email"===e?/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/:"";""!==t&&a.test(t)?(c(this).removeClass("ulmc-save-result__form-field--error"),l[e]=!0):""===t||a.test(t)||(l[e]=!1)}),Object.values(l).every(Boolean)}},{key:"validateAcceptance",value:function(e){var t=!0,a=e.find("input[name=ulmc_user_acceptance]");return a.length?a.is(":checked")?(t=!0,e.find(".ulmc-checkbox--privacy").removeClass("ulmc-empty")):(t=!1,e.find(".ulmc-checkbox--privacy").addClass("ulmc-empty")):t=!0,t}},{key:"switchInit",value:function(){c(".ulmc-switch-option").click(function(){var e=c(this).data("position"),t=c(this).parent().find("input");"left"==e?t.prop("checked",!1):t.prop("checked",!0),t.trigger("change")})}},{key:"showHelp",value:function(){c(".ulmc-note__open").click(function(){var e=c(this).parent().attr("data-id");c("#"+e).slideToggle()}),c(".ulmc-note__close").click(function(){c(this).parent().slideUp()})}},{key:"showScheduleTable",value:function(){var t=c(this.widgetClass);c(".ulmc-schedule__show").click(function(){var e=t.find(".ulmc-schedule");e.hasClass("active")?(e.removeClass("active"),e.slideUp(),c(this).text(window.ulmc_vars.i18n.showScheduleButtonText)):(e.addClass("active"),e.slideDown(),c(this).text(window.ulmc_vars.i18n.hideScheduleButtonText),c("html, body").animate({scrollTop:e.offset().top-50},1200))})}},{key:"addHTMLNotice",value:function(e,t,a,l){e=e.find(".ulmc-result-form-notices");e.append('<div class="ulmc-result-form-notice ulmc-result-form-notice--'+t+" ulmc-result-form-notice--"+a+'  ulmc-show">'+l+"</div>"),e.find(".ulmc-result-form-notice--"+a).slideDown({direction:"up"},400)}},{key:"addNotice",value:function(e,t,a,l){e=e.find(".ulmc-save-result__form-notices");e.append('<div class="ulmc-save-result__form-notice ulmc-save-result__form-notice--'+t+" ulmc-save-result__form-notice--"+a+'  ulmc-show"><span>'+l+"</span></div>"),e.find(".ulmc-save-result__form-notice--"+a).slideDown({direction:"up"},400)}},{key:"removeNotice",value:function(e,t){var a=e.find(".ulmc-save-result__form-notice--"+t);a.hasClass("ulmc-show")&&(a.removeClass("ulmc-show"),a.slideUp({direction:"down"},400),setTimeout(function(){a.remove()},400))}},{key:"displayError",value:function(e,t,a){var l,n=c(".ulmc-save-result__form-notice--"+t);switch(t){case"filled_fields":l=window.ulmc_vars.i18n.emptyFields;break;case"required_fields":l=window.ulmc_vars.i18n.emptyRequiredFields;break;case"valid_fields":l=window.ulmc_vars.i18n.invalidFields;break;case"acceptance":l=window.ulmc_vars.i18n.acceptanceMessage}n.length||a?n.length&&1==a&&ulmc.removeNotice(e,t):(ulmc.addNotice(e,"error",t,l),"filled_fields"===t&&(n=e.find(".ulmc-empty")).length&&c("html, body").animate({scrollTop:n.offset().top-50},1200))}},{key:"setCssVariables",value:function(){var e=c(this.widgetClass),n=this;e.each(function(){var e=c(this).data("colors"),t=c(this).data("font-size");if(document.documentElement.style.setProperty("--ulmc-font-size",t),e)for(var a in e){var l=n.convertColorHexToRgb(e[a]);document.documentElement.style.setProperty("--ulmc-"+a,l)}})}},{key:"formatMoneyValue",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",a="";return t&&""!==t&&(a+=t+" "),a+=e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}},{key:"convertColorHexToRgb",value:function(e){return 3===(e="#"==e.substring(0,1)?e.substring(1):e).length&&(e=e.split("").map(function(e){return e+e}).join("")),parseInt(e.substring(0,2),16)+","+parseInt(e.substring(2,4),16)+","+parseInt(e.substring(4),16)}},{key:"fixGutenbergBlock",value:function(){var e=!1,t=this,a=setInterval(function(){document.querySelector(t.widgetClass)&&(t.setCssVariables(),e=!0),e&&clearInterval(a)},500)}}]))();window.ulmc=new e,ulmc.init()})(jQuery);